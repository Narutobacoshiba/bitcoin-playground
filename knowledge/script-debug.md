# Script debug

Script development requires debugging to pinpoint the issue
* https://siminchen.github.io/bitcoinIDE/build/editor.html

## btcdeb tool
Original work using btcdeb is used to test BallGameContract: https://github.com/Narutobacoshiba/script-playground

download: https://github.com/bitcoin-core/btcdeb/tree/master

guide: https://github.com/bitcoin-core/btcdeb/blob/master/doc/btcdeb.md

need to provide a working script example for btcdeb usage with Taproot

need to change code of btcdeb to enable OP_CHECKSIGADD for Taproot: https://github.com/bitcoin-core/btcdeb/pull/151

## examples
Script `btcdeb '[OP_ADD OP_2 OP_EQUAL]' 1 1` will open up a window that lists Bitcoin stack:

```
script   |  stack 
---------+--------
OP_ADD   |      01
2        |      01
OP_EQUAL | 
#0000 OP_ADD
```

`step` to continue, `rewind` to go back in stack

## construct a taptree
Using `tap`, we will provide `<internal_pubkey>`, `script_count` for the number of direct leaf, and the following scripts.

`tap 7dec1d4eb66497d20ad3ce1a8f7e99d207e5dadf4a093a3dede664dd89d9ac10 1 '[2bc2cfa7264c496a23e3f735b2bb586ea7ace3953fb5556206a68f744406fc45 OP_CHECKSIG OP_SWAP d9b98ef2c580416ca828801f5c3d0afb81b10639f5b5a1abe81dad89af7779af OP_CHECKSIGADD OP_SWAP e0fce228941493bb4dbab3c38e9b762dc0c500b0d4f5485734efd39a37dfd067 OP_CHECKSIGADD OP_2 OP_EQUAL]'`

tap 7dec1d4eb66497d20ad3ce1a8f7e99d207e5dadf4a093a3dede664dd89d9ac10 1 '[2bc2cfa7264c496a23e3f735b2bb586ea7ace3953fb5556206a68f744406fc45 OP_CHECKSIG d9b98ef2c580416ca828801f5c3d0afb81b10639f5b5a1abe81dad89af7779af OP_CHECKSIGADD OP_2 OP_EQUAL]'

adding OP_CHECKSIGADD will lead to error, what the hell? https://github.com/bitcoin-core/btcdeb/pull/151

`tap --privkey=4ec4caf5e470d93f2b76847543052200909762bd547b82454751193968992f52 7dec1d4eb66497d20ad3ce1a8f7e99d207e5dadf4a093a3dede664dd89d9ac10 1 '[2bc2cfa7264c496a23e3f735b2bb586ea7ace3953fb5556206a68f744406fc45 OP_CHECKSIG OP_SWAP d9b98ef2c580416ca828801f5c3d0afb81b10639f5b5a1abe81dad89af7779af OP_CHECKSIGADD OP_SWAP e0fce228941493bb4dbab3c38e9b762dc0c500b0d4f5485734efd39a37dfd067 OP_CHECKSIGADD OP_2 OP_EQUAL]'`

`txid=eeffe81e32329551856716daadc137bf55e2f56350bd00338424c58e9727f568`

tx=020000000168f527978ec524843300bd5063f5e255bf37c1adda166785519532321ee8ffee0000000000fdffffff01905f01000000000016001449a814bd6c9de53194bb0b5616ccccac167536d500000000

`--txin=02000000000106ad24a82024841cb87341b41f011209561bae7def1568bfc5f642905d6cb0f05a0000000000fdffffff6286c59cc9c749cd3f058db247511a2569d3871f69788ef4d3a0c2f4ddd7ed7c0000000000fdffffff21bdb92082267cbc7ee76993d56481732b2a385d82d478496ee3fa647a4c51aa0000000000fdffffff086aa21eb1d30217eb31668f0074cecfaf874d6e90720ec73bd2ff550d4956f50000000000fdffffff7c6ebd2a818aca05cb6076d1e37e6b29ca544aad74ab89f68521577d2c75c1d80000000000fdffffff827c6116a8fbe1c0bca7f8832cf8499f57263d0564ef76ba821a45efa993409f0000000000fdffffff01a086010000000000225120eb4bc01410873805dc05e4f0a41ca775f2f571f20e5ea5e8b7dcbbb38cd7f845024730440220453f37c8b927c1e5f943a6b057f0bf44a0d48114902a7f8aa39045094ddfeab802202eafef0fe89e27c5f1b0ae4788da683f82f8868b45908f677c474f075e07e4390121037c7ce96a5bd9565f2dfc87f1c09845e0b1ed4942553cd8a89148e59e8c4a19b7024730440220383e366cd2fce6749dfa78ba692e4d5657c8814ce29444443218a73adda23e1c02200e3f3233898398b1a8e3a798b166cbb57363bd3aed50a904891a066372bca2c501210244f5f6ce30458dab5c3bafe46b782c624a1d600fc328242ccdd2233f9afb6f3c0247304402206e22b800741b0767f6159f204fef1d9dba9b7bfbc3d164e74c3b3b20c7d7b1310220711998ae8bb2a6a27e44e9cb8df72068f418cc40236dfe0eafb1c07b55b7974b0121022c03ec8b0efac66de4fe757642ad7fcc9e21e17169117cee4698de71bfa3fbef024730440220431b8349e153022160920215352a0aad625cea9cd242a78d660932ed1987b085022058f26f072dde7569ac87c261abb2c1a7df3f55a7f4bf383848a58597da0e7d8d01210276ea3723a083600af5d71a93e363dbb1a6e15c37dfe0f7c46725a4c3bfb87ca202473044022008edb7569fc5284fced2b931f1b1fbdf527d163c349c6909d931ef1158c10f2f0220060815ee02851e025464c9988afb47abca976f331560043e095b3ba352ddbf420121023ec010270e539b961c5a1064a8501e00eb0d29d199735ea94bf5a54505cd37ef0247304402206df07898c52b65ec6cde38850d20e6009b7a4a73ffb571468b4b33f1f0ca31ca02203cc2f4d0817aabe9ba6652f9e6c25d536a81c9ba7cecf00210660e4df3fb9450012102dcadd9e658f45da07e03d347287abf4c2cd92de855e7156bff0532c94062430e00000000`

tap --addrprefix=bcrt --tx=020000000168f527978ec524843300bd5063f5e255bf37c1adda166785519532321ee8ffee0000000000fdffffff01905f01000000000016001449a814bd6c9de53194bb0b5616ccccac167536d500000000 --txin=02000000000106ad24a82024841cb87341b41f011209561bae7def1568bfc5f642905d6cb0f05a0000000000fdffffff6286c59cc9c749cd3f058db247511a2569d3871f69788ef4d3a0c2f4ddd7ed7c0000000000fdffffff21bdb92082267cbc7ee76993d56481732b2a385d82d478496ee3fa647a4c51aa0000000000fdffffff086aa21eb1d30217eb31668f0074cecfaf874d6e90720ec73bd2ff550d4956f50000000000fdffffff7c6ebd2a818aca05cb6076d1e37e6b29ca544aad74ab89f68521577d2c75c1d80000000000fdffffff827c6116a8fbe1c0bca7f8832cf8499f57263d0564ef76ba821a45efa993409f0000000000fdffffff01a086010000000000225120eb4bc01410873805dc05e4f0a41ca775f2f571f20e5ea5e8b7dcbbb38cd7f845024730440220453f37c8b927c1e5f943a6b057f0bf44a0d48114902a7f8aa39045094ddfeab802202eafef0fe89e27c5f1b0ae4788da683f82f8868b45908f677c474f075e07e4390121037c7ce96a5bd9565f2dfc87f1c09845e0b1ed4942553cd8a89148e59e8c4a19b7024730440220383e366cd2fce6749dfa78ba692e4d5657c8814ce29444443218a73adda23e1c02200e3f3233898398b1a8e3a798b166cbb57363bd3aed50a904891a066372bca2c501210244f5f6ce30458dab5c3bafe46b782c624a1d600fc328242ccdd2233f9afb6f3c0247304402206e22b800741b0767f6159f204fef1d9dba9b7bfbc3d164e74c3b3b20c7d7b1310220711998ae8bb2a6a27e44e9cb8df72068f418cc40236dfe0eafb1c07b55b7974b0121022c03ec8b0efac66de4fe757642ad7fcc9e21e17169117cee4698de71bfa3fbef024730440220431b8349e153022160920215352a0aad625cea9cd242a78d660932ed1987b085022058f26f072dde7569ac87c261abb2c1a7df3f55a7f4bf383848a58597da0e7d8d01210276ea3723a083600af5d71a93e363dbb1a6e15c37dfe0f7c46725a4c3bfb87ca202473044022008edb7569fc5284fced2b931f1b1fbdf527d163c349c6909d931ef1158c10f2f0220060815ee02851e025464c9988afb47abca976f331560043e095b3ba352ddbf420121023ec010270e539b961c5a1064a8501e00eb0d29d199735ea94bf5a54505cd37ef0247304402206df07898c52b65ec6cde38850d20e6009b7a4a73ffb571468b4b33f1f0ca31ca02203cc2f4d0817aabe9ba6652f9e6c25d536a81c9ba7cecf00210660e4df3fb9450012102dcadd9e658f45da07e03d347287abf4c2cd92de855e7156bff0532c94062430e00000000 7dec1d4eb66497d20ad3ce1a8f7e99d207e5dadf4a093a3dede664dd89d9ac10 1 '[2bc2cfa7264c496a23e3f735b2bb586ea7ace3953fb5556206a68f744406fc45 OP_CHECKSIG OP_SWAP d9b98ef2c580416ca828801f5c3d0afb81b10639f5b5a1abe81dad89af7779af OP_CHECKSIGADD OP_SWAP e0fce228941493bb4dbab3c38e9b762dc0c500b0d4f5485734efd39a37dfd067 OP_CHECKSIGADD OP_2 OP_EQUAL]'